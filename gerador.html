        <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br">
        <head>      
            <title>Grafico</title>
            <meta http-equiv="content-type" content="text/plain" charset="UTF-8" />
            <meta http-equiv="content-language" content="pt-br" />

        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.9.2/dojo/dojo.js"></script>

        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.9.2/dijit/themes/tundra/tundra.css">
        
        <script type="text/javascript" src="../util/javascript/xtr-grafico-util.js"></script>
        <script type="text/javascript" src="../util/javascript/xtr-query.js"></script>        
        <script type="text/javascript" src="../util/javascript/xtr-require.js"></script>

        <script type="text/javascript" src="../tab/javascript/xtr-paginacao-script.js"></script>
        <script type="text/javascript" src="../tab/javascript/xtr-tab.js"></script>
        <script type="text/javascript" src="../tab/javascript/xtr-side-bar.js"></script>
        
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-principal.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-parametros.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-modulos.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-estilos.js"></script>

        <script type="text/javascript" src="../inputs/javascript/xtr-table.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-butao.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-checkbox.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-select.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-svg.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-input.js"></script>

        <script type="text/javascript" src="../inputs/javascript/xtr-table-maker.js"></script>

        <script type="text/javascript" src="../tooltip/javascript/xtr-tooltip.js"></script>

        <script type="text/javascript" src="../datahandler/javascript/xtr-datahandler.js"></script>
        <script type="text/javascript" src="../datahandler/javascript/xtr-grafico-geografico.js"></script>

        <script type="text/javascript" src="source/source.js"></script>

        <script type="text/javascript" src="source/icones.js"></script>
        <script type="text/javascript" src="loading.js"></script>

        <link rel="stylesheet" href="../tab/css/xtr-tab.css">

        <link rel="stylesheet" href="../inputs/css/xtr-butao.css">
        <link rel="stylesheet" href="../inputs/css/xtr-checkbox.css">
        <link rel="stylesheet" href="../inputs/css/xtr-select.css">
        <link rel="stylesheet" href="../inputs/css/xtr-table.css">

        <link rel="stylesheet" href="../tooltip/css/xtr-tooltip.css">

        <link rel="stylesheet" href="../grafico/css/xtr-grafico.css">

        <link rel="stylesheet" href="css/foundation-icons/foundation-icons.css">
        <link rel="stylesheet" href="css/xtr-icon-size.css">
        <link rel="stylesheet" href="css/xtr-alert.css">

        <link rel="stylesheet" href="css/chartbox.css">
        <link rel="stylesheet" href="css/flexbox.css">
        <link rel="stylesheet" href="css/loading.css">
        <link rel="stylesheet" href="css/divider.css">

        <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,700' rel='stylesheet' type='text/css'>
        
    </head>

    <body class="tundra" style="margin:auto; width:800px">
        <input type="text" id="tipo" placeholder="Tipo" value="colunas"/>
        <input type="text" id="tema" placeholder="Tema" value="popkitblue"/>
        <input type="number" id="nSeries" placeholder="Series" value="7"/>
        <input type="number" id="nPontos" placeholder="Pontos/Serie" value="8"/>
        <input type="text" id="titulosidentificadores" placeholder="Eixo de Identificadores" />
        <input type="text" id="titulosvalores" placeholder="Eixo de Valores" />
        <div id="NAVBAR" class="xtrTabMenu left-align">
            <ul>
                <li 
                    id = "currentChart"
                    data-xtr-tab="_xtr_tab_grafico_principal"
                    data-xtr-tab-onload="nowYouSeeMe(this)">
                    <i class="fi-home iconSize25"></i>
                </li>

                <li 
                    class="active" 
                    id="customizeChart"
                    data-xtr-tab="_xtr_tab_grafico_personalizado"
                    data-xtr-tab-onload="nowYouSeeMeMore(this,'_xtr_tabela_grafico_personalizado',false)">
                    <i class="fi-pencil iconSize25"></i>
                </li> 

                <li 
                    id="mergeChart"
                    data-xtr-tab="_xtr_tab_grafico_personalizado2"
                    data-xtr-tab-onload="nowYouSeeMeMore(this,'_xtr_tabela_grafico_personalizado2',true)">
                    <i class="fi-plus iconSize25"></i>
                </li>
            </ul>
        </div>
        <div id="SIDEBAR" class="xtrTabMenu wide100 vertical left divided">

        </div>  
        <div id="chartbox" class="chartbox">

            <div id="content" class="clearfix content" style="width:100%">
                <div id="_xtr_tab_grafico_principal">
                    <div 
                        id="_xtr_grafico" 
                        class="xtrGrafico">
                    </div>

                    <div 
                        id="_xtr_grafico_legenda" 
                        class="xtrLegenda">
                    </div>
                </div>

                <div id="_xtr_tab_grafico_personalizado" style="max-width:1080px;margin:auto">
                    <table 
                        id="_xtr_tabela_grafico_personalizado"
                        class="xtrTable"  
                        style="min-width:100%;">                       
                    </table>
                </div>

                <div id="_xtr_tab_grafico_personalizado2" style="max-width:1080px;margin:auto">
                    <table 
                        id="_xtr_tabela_grafico_personalizado2"
                        class="xtrTable"  
                        style="min-width:100%;overflow: hidden;">                       
                    </table>
                </div>
            </div>

        </div>
        
        <script type="text/javascript"> 
        ///////////
        //TRASH  //
        ///////////
            rawData.alt.grafico = [
                {
                    colunas: [1],
                    mostrar: true,
                    tipo: "pizza"
                },
            ];      
        ////////////////////////
        //VARIAVEIS DE ESCOPO //
        ////////////////////////
            var compositeDatas,compositeData;
            /**
             * dataHandler, dados contidos nesse objeto não alteram nunca, usado somente para leitura
             */
            var dataHandler;
            /**
             * compositeDataHandler, dados contidos nesse objeto alteram cosntatemente, usado para leitura/escrita
             * dados que estão sendo exibidos, ou que estão sendo armazenados(como interface);
             */
            var compositeDataHandler;

            var loading;

            var sideBar;

            var xtrAble;
            var xtrTab;
            var xtrPaginacaoScript;

        ///////////////
        //CONSTRUCAO //
        ///////////////
        try{
            document.body.addEventListener("keypress",function(event){
                if(event.keyCode == 27 & event.charCode == 0 || event.key == "Escape"){
                    var closeButton = document.getElementById("view\:_id1\:_id2\:callback1\:_id127\:_id128\:_id132\:_id233\:button1");
                    if(closeButton != null)
                        closeButton.click();
                }
            });
            //rawData = #{javascript: xtrJson(compositeData); };
            if(rawData.alt){
                rawData=rawData.alt;
            }
            dataHandler = new DataHandler(rawData);            
            compositeDatas = dataHandler.load();
            compositeDatas.sort(function(a,b){
                return a.series.length < b.series.length;
            });

            loading = new Loading("chartbox");

            console.log("RAW",rawData);

            console.log("CPD",compositeDatas);

            compositeDataHandler = new CompositeDataHandler(compositeDatas);    

            sideBar = new SideBar("#SIDEBAR");

            xtrTab = new XtrTab("#NAVBAR");
            xtrTooltipNAVBAR = new XtrTooltip("NAVBAR_tooltip","bottom");
            xtrTooltipNAVBAR.addTrigger("#currentChart",{
                content: "Grafico Atual"
            });
            xtrTooltipNAVBAR.addTrigger("#mergeChart",{
                content: "Mesclar Graficos"
            });
            xtrTooltipNAVBAR.addTrigger("#customizeChart",{
                content: "Personalizar Grafico"
            });
            xtrAble = new XtrAble();

            chunkSize = 5;

            if(dataHandler.search("tabela",0).rotulos.length > 30){
                xtrAble.disable("customizeChart",true);
                xtrAble.disable("mergeChart",true);
            }

            heritage("chartbox");
        }
        catch(e){
            console.error(e);
            removeLoading();
            document.getElementById("content").remove();
        }
            
        ////////////////////////////
        //METODOS DE CARREGAMENTO //
        ////////////////////////////
            function removeLoading(){
                loading.removeLoading();
            }
            function addLoading(){
                loading.addLoading();
            }
        //////////////////////////////////
        //METODOS DE GERAÇÃO DE GRAFICO //
        //////////////////////////////////
            function nowYouSeeMe(x){
                var element = document.querySelector("[data-compositeData-index]");
                element.click();
                element.className = element.className.replace("active","");
                element.className = element.className + " active";
            }
            function escalonador(where){
                var localChart;
                var enable;
                var alert;
                var color;

                localChart = new SuperChart(compositeDataHandler.current());

                enable = !localChart.areOneOfTheseMyChartType(['empilhadas']);

                alert = enable ? "default" : "verde";
                color = enable ? "rgba(180,180,180,.5)" : "";

                checkboxObj = {
                    id: "xtrCheckbox_escalonador",
                    checked: localChart.isThisMyScaleType("justa"),
                    disabled: enable,
                    text:{
                        color: color                       
                    },
                    content: "Justaposição(%)",
                    type: "verde",
                    "class": "xtrAlert xtrAlert-"+alert,
                    addEventListener: {
                        where: "input",
                        type: "change",
                        func: function(x,type,objAux){
                            var labelText;
                            var label;
                            var input;
                            var compositeData;

                            labelText = objAux.labelText;
                            label = objAux.label;
                            input = objAux.input;
                            compositeData = compositeDataHandler.current();

                            if(input.checked)
                                compositeData.escala = "justa";
                            else
                                compositeData.escala = "linear";

                            compositeDataHandler.override(compositeData);

                            changeChart(compositeData);

                            elements = document.getElementById(xtrGrafico.ID_LEGENDA).querySelectorAll(".xtrCheckboxElement[data-legenda]");
                            var element;
                            var elementIndex;
                            for(elementIndex = 0; elements.length > elementIndex; elementIndex++){
                                element = elements[elementIndex];
                                element.setAttribute("checked",!element.getAttribute("checked"));
                                element.firstChild.setAttribute("checked",!element.getAttribute("checked"));
                            }               
                        }
                    }
                } 
                div = document.createElement("div");
                div.className += " flexbox"
                xtrCheckbox = XtrCheckbox(checkboxObj).node;
                var hr = document.createElement("hr");
                where.appendChild(hr);
                div.appendChild(xtrCheckbox);
                where.appendChild(div);
            }                    
       
            //////////////////////////////////////////////
            //METODOS PARA MANIPULAÇÂO DO COMPOSITEDATA //
            //////////////////////////////////////////////
                function generateWithLoading(compositeData){                
                    compositeDataHandler.override(compositeData);
                    var objTipo;

                    if(compositeData.tipo.indexOf("geografica") >= 0){
                        makeGeoChart(compositeData);
                    }
                    else{
                        generate(compositeData,{
                            beforeStart: addLoading,
                            onLegend: function(context){  
                                var elemLege = document .getElementById(context.legenda);                     
                                escalonador(elemLege);
                            },
                            afterEnd: removeLoading
                        });
                    }
                }
                function makeGeoChart(compositeData){
                    var SVGREF;

                    var series,serie;

                    var compositeData;

                    var localChart;

                    var subTipo;

                    var script;
                    var cords;

                    localChart = new SuperChart(compositeData);

                    series = compositeData.series;

                    serie = series[0];
                    subTipo = compositeData.tipo.split("/");
                    subTipo = subTipo[1];
                    subTipo = subTipo.toUpperCase();

                    addLoading();

                    document.getElementById(xtrGrafico.ID_LEGENDA).innerHTML="";
                    document.getElementById(xtrGrafico.ID_GRAFICO).innerHTML="";

                    var toEval = "XTR_"+subTipo;
                    console.log(toEval);

                    xtrRequire(toEval,function(){

                        cords = eval(toEval);

                        var param = new SuperParameter(localChart);

                        geoAreaGrafico(compositeData,cords,180,50,180,0.05,20);
                        geoAreaLegenda(compositeData,180,50,180,5,0.05,20,param.getLegend().style);
                        stylish(localChart).legendIcons(false,true);
                        stylish(localChart).labelText();
                        removeLoading();
                        //stylish(localChart).legendContainer();
                    });
                }
        ////////////////////////
        //METODOS PARA TABELA //
        ////////////////////////
            ////////////////////////////////
            //METODO DE CRIACAO DE TABELA //
            ////////////////////////////////
                function nowYouSeeMeMore(context,tableId,mesclar){
                    var compositeData;

                    compositeData = dataHandler.search("tabela",0);

                    if(compositeData.rotulos.length > 30){
                        alert("Não é possivel personalizar grafico com dados por Município");
                        return;
                    }

                    document.getElementById(tableId).innerHTML="";

                    addLoading();

                    makeTable(tableId,mesclar);

                    if(!XtrGraficoUtil.isobj(xtrPaginacaoScript)){
                        xtrPaginacaoScript = {};
                    } 

                    xtrPaginacaoScript[tableId] = new XtrPaginacaoScript({
                        containerSelector: "#"+tableId,
                        elementAttribute: "data-colunaIndex",
                        chunkSize: chunkSize,
                        chunckNumber: 0,
                        paginator:["#"+tableId+"_paginasTop","#"+tableId+"_paginasBottom"]
                    });   
                    
                    removeLoading();
                }
                function makeTable(tableId,mesclando){
                    var tableMaker;

                    var compositeData;

                    compositeData = dataHandler.search("tabela",0);

                    tableMaker = TableMaker(tableId,compositeData,chunkSize,mesclando);
                    tableMaker.make(true);
                }                   
        </script>
    </body>
    </html>