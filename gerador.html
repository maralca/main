        <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br">
        <head>      
            <title>Grafico</title>
            <meta http-equiv="content-type" content="text/plain" charset="UTF-8" />
            <meta http-equiv="content-language" content="pt-br" />

        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.9.2/dojo/dojo.js"></script>

        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.9.2/dijit/themes/tundra/tundra.css">
        
        <script type="text/javascript" src="../util/javascript/xtr-grafico-util.js"></script>  
        <script type="text/javascript" src="../util/javascript/xtr-require.js"></script>

        <script type="text/javascript" src="../tab/javascript/xtr-paginacao-script.js"></script>
        <script type="text/javascript" src="../tab/javascript/xtr-tab.js"></script>
        <script type="text/javascript" src="../tab/javascript/xtr-side-bar.js"></script>
        
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-principal.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-parametros.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-modulos.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-estilos.js"></script>
        <script type="text/javascript" src="../grafico/javascript/xtr-grafico-geografico.js"></script>

        <script type="text/javascript" src="../inputs/javascript/xtr-table.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-butao.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-checkbox.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-select.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-svg.js"></script>
        <script type="text/javascript" src="../inputs/javascript/xtr-input.js"></script>

        <script type="text/javascript" src="../geochart/libs/XTR_MUNICIPIOS_INFO.js"></script>

        <script type="text/javascript" src="../inputs/javascript/xtr-table-maker.js"></script>

        <script type="text/javascript" src="../tooltip/javascript/xtr-tooltip.js"></script>

        <script type="text/javascript" src="../datahandler/javascript/xtr-datahandler.js"></script>

        <script type="text/javascript" src="source/source.js"></script>
        <script type="text/javascript" src="source/sourceBahiaMuni.js"></script>
        <script type="text/javascript" src="source/sourceEstados.js"></script>
        <script type="text/javascript" src="source/sourceBrasilMuni.js"></script>
        <script type="text/javascript" src="source/sourceCearaMuni.js"></script>
        <script type="text/javascript" src="source/sourceAlagoasMuni.js"></script>
        <script type="text/javascript" src="source/sourceMeso.js"></script>
        <script type="text/javascript" src="source/sourceMicro.js"></script>

        <script type="text/javascript" src="source/icones.js"></script>
        <script type="text/javascript" src="loading.js"></script>

        <link rel="stylesheet" href="../tab/css/xtr-tab.css">
        <link rel="stylesheet" href="../tab/css/xtr-paginacao-script.css">

        <link rel="stylesheet" href="../inputs/css/xtr-butao.css">
        <link rel="stylesheet" href="../inputs/css/xtr-checkbox.css">
        <link rel="stylesheet" href="../inputs/css/xtr-select.css">
        <link rel="stylesheet" href="../inputs/css/xtr-table.css">

        <link rel="stylesheet" href="../tooltip/css/xtr-tooltip.css">

        <link rel="stylesheet" href="../grafico/css/xtr-grafico.css">

        <link rel="stylesheet" href="css/foundation-icons/foundation-icons.css">
        <link rel="stylesheet" href="css/xtr-icon-size.css">
        <link rel="stylesheet" href="css/xtr-alert.css">

        <link rel="stylesheet" href="css/chartbox.css">
        <link rel="stylesheet" href="css/flexbox.css">
        <link rel="stylesheet" href="css/loading.css">
        <link rel="stylesheet" href="css/divider.css">

        <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,700' rel='stylesheet' type='text/css'>
        
    </head>

    <body class="tundra" style="margin:auto; width:800px">
        <div id="NAVBAR" class="xtr tab menu alinhamento a esquerda">
            <ul>
                <li 
                    class="ativa" 
                    id = "currentChart"
                    data-tab-id="tab_exibir"
                    data-tab-fn="nowYouSeeMe(this)"
                    data-tab-allways-fn="refreshType"
                    data-tab-onfirst-fn="">
                    <i class="fi-home iconSize25"></i>
                </li>

                <li 
                    id="customizeChart"
                    data-tab-id="tab_personalizar"
                    data-tab-fn="customizar"
                    data-tab-allways-fn=""
                    data-tab-onfirst-fn="">
                    <i class="fi-pencil iconSize25"></i>
                </li> 

                <li 
                    id="mergeChart"
                    data-tab-id="tab_mesclar"
                    data-tab-fn="mesclar">
                    <i class="fi-plus iconSize25"></i>
                </li>
            </ul>
        </div>
        <div id="SIDEBAR" class="xtr tab menu padding reduzido alinhamento vertical esquerda dividido">
        </div>  
        <div id="chartbox" class="chartbox">
            <div id="content" class="clearfix content" style="width:100%">
                <div id="tab_exibir">
                    <div 
                        id="_xtr_grafico" 
                        class="xtrGrafico">
                    </div>
                    <div 
                        id="_xtr_grafico_legenda" 
                        class="xtrLegenda">
                    </div>
                </div>
                <div id="tab_personalizar" style="max-width:1080px;margin:auto">
                    <table 
                        id="tabela_personalizar"
                        class="xtrTable"  
                        style="min-width:100%;">                       
                    </table>
                </div>
                <div id="tab_mesclar" style="max-width:1080px;margin:auto">
                    <table 
                        id="tabela_mesclar"
                        class="xtrTable"  
                        style="min-width:100%;overflow: hidden;">                       
                    </table>
                </div>
            </div>

        </div>
        
        <script type="text/javascript">
        ///////////
        //TRASH  //
        ///////////
            // rawData.alt.grafico = [
            //     {
            //         colunas: [1],
            //         mostrar: true,
            //         tipo: "pizza"
            //     },
            // ];   
        rawData = {"coluna":[{"url":[],"dadosFormatados":["2001","2002","2003","2004","2005","2006","2007","2008","2009","2011","2012","2013","2014"],"dados":["2001","2002","2003","2004","2005","2006","2007","2008","2009","2011","2012","2013","2014"],"titulo":"Ano","tipo":"cronologica"},{"dadosFormatados":["21.545","22.526","24.015","24.977","25.681","26.459","28.816","30.551","31.157","34.176","36.450","37.881","38.630"],"dados":[21545,22526,24015,24977,25681,26459,28816,30551,31157,34176,36450,37881,38630],"unidade":"mil domicílios","titulo":"Qtd de Domicílios - Tinham Rede Coletora","somaHorizontal":"SH1","somaVertical":true,"tipo":"absoluto"},{"dadosFormatados":["10.108","10.486","10.472","10.824","11.368","12.030","12.488","11.982","11.640","13.772","13.149","11.720","12.823"],"dados":[10108,10486,10472,10824,11368,12030,12488,11982,11640,13772,13149,11720,12823],"unidade":"mil domicílios","titulo":"Qtd de Domicílios - Tinham Fossa Séptica","somaHorizontal":"SH1","somaVertical":true,"tipo":"absoluto"},{"dadosFormatados":["12.137","12.193","12.604","13.346","13.463","13.591","12.498","13.372","2.112","2.029","1.950","1.831","1.974"],"dados":[12137,12193,12604,13346,13463,13591,12498,13372,2112,2029,1950,1831,1974],"unidade":"mil domicílios","titulo":"Qtd de Domicílios - Tinham Outro","somaHorizontal":"SH1","somaVertical":true,"tipo":"absoluto"},{"dadosFormatados":["3.626","3.282","2.992","2.957","2.861","2.666","2.536","2.276","2.111","1.838","1.649","1.588","1.431"],"dados":[3626,3282,2992,2957,2861,2666,2536,2276,2111,1838,1649,1588,1431],"unidade":"mil domicílios","titulo":"Qtd de Domicílios - Não Tinham","somaHorizontal":"SH1","somaVertical":true,"tipo":"absoluto"},{"dadosFormatados":["47.423","48.492","50.087","52.107","53.373","54.747","56.338","58.181","59.253","62.116","63.769","65.131","67.038"],"dados":[47423,48492,50087,52107,53373,54747,56338,58181,59253,62116,63769,65131,67038],"unidade":"mil domicílios","titulo":"Qtd Total de Domicílios","somaHorizontal":null,"somaVertical":true,"tipo":"absoluto"}],"sortedColumn":3,"sortedOrder":"descending","titulo":"Domicílios por Esgotamento Sanitário - PNAD -  – Brasil"}
        //rawData = rawDataMicro;
        //rawData = rawDataMeso;
        //rawData = rawDataEstados;
         //rawData = {"alt":{"coluna":[{"url":["http://xtr-tinto.consiste.com.br/big/cbx-r1.nsf/microrregiao.xsp?estado=BA&mesorregiao=EXTREMO+OESTE+BAIANO&_b=cbx&microrregiao=BARREIRAS&_v=mesorregiao","http://xtr-tinto.consiste.com.br/big/cbx-r1.nsf/microrregiao.xsp?estado=BA&mesorregiao=EXTREMO+OESTE+BAIANO&_b=cbx&microrregiao=COTEGIPE&_v=mesorregiao","http://xtr-tinto.consiste.com.br/big/cbx-r1.nsf/microrregiao.xsp?estado=BA&mesorregiao=EXTREMO+OESTE+BAIANO&_b=cbx&microrregiao=SANTA+MARIA+DA+VIT%C3%93RIA&_v=mesorregiao"],"dadosFormatados":["BARREIRAS","COTEGIPE","SANTA MARIA DA VITÓRIA"],"dados":["BARREIRAS","COTEGIPE","SANTA MARIA DA VITÓRIA"],"titulo":"Microrregião","tipo":"geografica"},{"dadosFormatados":["48","4","15"],"dados":[48,4,15],"unidade":"aeródromo","titulo":"Qtd de Aeródromos","somaHorizontal":null,"somaVertical":true,"tipo":"absoluto"}],"titulo":"Aeródromos -  – Microrregiões da Mesorregião Extremo Oeste Baiano (Bahia)"}};
        ////////////////////////
        //VARIAVEIS DE ESCOPO //
        ////////////////////////
            var compositeDatas,compositeData;
            /**
             * dataHandler, dados contidos nesse objeto não alteram nunca, usado somente para leitura
             */
            var dataHandler;
            /**
             * compositeDataHandler, dados contidos nesse objeto alteram cosntatemente, usado para leitura/escrita
             * dados que estão sendo exibidos, ou que estão sendo armazenados(como interface);
             */
            var compositeDataHandler;

            var cookieHandler;

            var loading;

            var sideBar;

            var xtrAble;
            var xtrTab;

        ///////////////
        //CONSTRUCAO //
        ///////////////
        try{
        document.addEventListener("DOMContentLoaded",function(){
            
            //rawData = #{javascript: xtrJson(compositeData); };

            if(rawData.alt){
                rawData=rawData.alt;
            }
            dataHandler = new DataHandler(rawData);            
            compositeDatas = dataHandler.load();

            console.log("RAW",rawData);

            console.log("CPD",compositeDatas);

            cookieHandler = new CookieHandler();

            compositeDataHandler = new CompositeDataHandler(compositeDatas);
            compositeDataHandler.addToAll("tema",cookieHandler.get("xtr_grafico_tema"));

            chunkSize = 5;

            loading = new Loading("chartbox");

            xtrTab = new XtrTab("#NAVBAR");

            sideBar = new SideBar("#SIDEBAR",{
                "allways-fn": refreshType,
                "adapter-fn": refreshTheme
            });

            xtrTooltipNAVBAR = new XtrTooltip("NAVBAR_tooltip","baixo");
            xtrTooltipNAVBAR.addTrigger("#currentChart",{
                content: "Gráfico Atual"
            });
            xtrTooltipNAVBAR.addTrigger("#mergeChart",{
                content: "Mesclar Gráficos"
            });
            xtrTooltipNAVBAR.addTrigger("#customizeChart",{
                content: "Personalizar Gráfico"
            });
            xtrAble = new XtrAble();
        
            if(dataHandler.search("tabela",0).rotulos.length > 30){
                xtrAble.disable("customizeChart",true);
                xtrAble.disable("mergeChart",true);
            }

            heritage("chartbox");
        })}
        catch(e){
            console.error(e);
            removeLoading();
            document.getElementById("content").remove();
        }
        function customizar(){
            nowYouSeeMeMore('tabela_personalizar',false);
        }
        function mesclar(){
            nowYouSeeMeMore('tabela_mesclar',true);
        }
        function refreshTheme(compositeData){
            var tema;

            tema = document.getElementById("input_tabela_personalizar_tema");
            if(tema == null){
                tema = document.getElementById("input_tabela_mesclar_tema");
            }
            if(tema == null){
                return;
            }
            tema = tema.value;

            if(XtrGraficoUtil.isset(compositeData)){
                compositeData.tema = tema;
            }

            cookieHandler.set("xtr_grafico_tema",tema,3600);
            compositeDataHandler.addToAll("tema",tema);
        }
        function refreshType(){
            var select;

            var compositeData;
            var tipo;

            select = document.getElementById("tabela_personalizar_tipo");

            if(select == null)
                return

            compositeData = compositeDataHandler.current();
            tipo = compositeData.tipo;

            console.log(tipo);

            XtrDivSelect.selecionar(select,tipo);
        }
        function mesclarCustomizar(mesclando){
            if(mesclando){
                nowYouSeeMeMore('tabela_mesclar',true);
            }
            else{                
                nowYouSeeMeMore('tabela_personalizar',false);
            }
        }
        ////////////////////////////
        //METODOS DE CARREGAMENTO //
        ////////////////////////////
            function removeLoading(){
                loading.removeLoading();
            }
            function addLoading(){
                loading.addLoading();
            }
        //////////////////////////////////
        //METODOS DE GERAÇÃO DE GRAFICO //
        //////////////////////////////////
            function nowYouSeeMe(x){
                setTimeout(function(){
                    nowYouSeeMe.once++ || 0;

                    var element = document.querySelector("[data-compositeData-first]");
                    if(element == null || nowYouSeeMe.once > 0){
                        element = document.querySelectorAll("[data-compositeData-index]");
                        if(element.length == 0) 
                            return;
                        element = element[0];
                    }
                    element.click();
                    element.className = element.className.replace("active","");
                    element.className = element.className + " active";
                },10);
            }
            function escalonador(where){
                var localChart;
                var enable;
                var alert;
                var color;

                localChart = new SuperChart(compositeDataHandler.current());

                enable = !localChart.areOneOfTheseMyChartType(['empilhadas']);

                alert = enable ? "default" : "verde";
                color = enable ? "rgba(180,180,180,.5)" : "";

                checkboxObj = {
                    id: "xtrCheckbox_escalonador",
                    checked: localChart.isThisMyScaleType("justa"),
                    disabled: enable,
                    text:{
                        color: color                       
                    },
                    content: "Justaposição(%)",
                    type: "verde",
                    "class": "xtr alert "+alert,
                    addEventListener: {
                        where: "input",
                        type: "change",
                        func: function(x,type,objAux){
                            var labelText;
                            var label;
                            var input;
                            var compositeData;

                            labelText = objAux.labelText;
                            label = objAux.label;
                            input = objAux.input;
                            compositeData = compositeDataHandler.current();

                            if(input.checked)
                                compositeData.escala = "justa";
                            else
                                compositeData.escala = "linear";

                            compositeDataHandler.override(compositeData);

                            changeChart(compositeData);

                            elements = document.getElementById(xtrGrafico.ID_LEGENDA).querySelectorAll(".xtrCheckboxElement[data-legenda]");
                            var element;
                            var elementIndex;
                            for(elementIndex = 0; elements.length > elementIndex; elementIndex++){
                                element = elements[elementIndex];
                                element.setAttribute("checked",!element.getAttribute("checked"));
                                element.firstChild.setAttribute("checked",!element.getAttribute("checked"));
                            }               
                        }
                    }
                } 
                div = document.createElement("div");
                div.className += " flexbox"
                xtrCheckbox = XtrCheckbox(checkboxObj).node;
                var hr = document.createElement("hr");
                where.appendChild(hr);
                div.appendChild(xtrCheckbox);
                where.appendChild(div);
            }                    
       
            //////////////////////////////////////////////
            //METODOS PARA MANIPULAÇÂO DO COMPOSITEDATA //
            //////////////////////////////////////////////
                function generateWithLoading(compositeData){                
                    compositeDataHandler.override(compositeData);
                    var objTipo;

                    if(compositeData.tipo.indexOf("geografica") >= 0){
                        makeGeoChart(compositeData);
                    }
                    else{
                        generate(compositeData,{
                            beforeStart: addLoading,
                            onLegend: function(context){  
                                var elemLege = document .getElementById(context.legenda);                     
                                escalonador(elemLege);
                            },
                            afterEnd: removeLoading
                        });
                        xtrTab.liberarChamada("tab_mesclar");
                    }
                }
                function makeGeoChart(compositeData){
                    var SVGREF;

                    var series,serie;

                    var compositeData;

                    var localChart;

                    var subTipos;

                    var script;
                    var cords;

                    var arq;

                    localChart = new SuperChart(compositeData);

                    series = compositeData.series;                    

                    serie = series[0];

                    arq = getFileName(compositeData.tipo);

                    addLoading();

                    var legenda = document.getElementById(xtrGrafico.ID_LEGENDA);
                    var grafico = document.getElementById(xtrGrafico.ID_GRAFICO);

                    for(graficoIndex = 0; grafico.childNodes.length > graficoIndex; graficoIndex++){
                        grafico.childNodes[graficoIndex].remove();
                    }
                    for(legendaIndex = 0; legenda.childNodes.length > legendaIndex; legendaIndex++){
                        legenda.childNodes[legendaIndex].remove();
                    }

                    legenda.innerHTML="";
                    grafico.innerHTML="";                    

                    console.log("before xtrRequire:",arq);

                    xtrRequire(arq,function(){
                        cords = eval(arq);
                        console.log(arq);

                        var param = new SuperParameter(localChart);

                        geoAreaGrafico(compositeData,{
                            coordenadas: cords,
                            color: {
                                red: 180,
                                green: 50,
                                blue: 180
                            }
                        });
                        geoAreaLegenda(compositeData,{
                            color:{
                                red: 180,
                                green: 50,
                                blue: 180
                            },
                            amount: 5,
                            style: param.getLegend().style
                        });
                        localChart.addTitle();
                        stylish(localChart).legendIcons(false,true);
                        stylish(localChart).labelText();
                        removeLoading();

                        cords = null;
                        XTR_MUNICIPIOS_INFO = null;

                        delete window.cords;
                        delete window.XTR_MUNICIPIOS_INFO;
                        delete cords;
                        delete XTR_MUNICIPIOS_INFO;

                    });
                }
                function getFileName(tipo){
                    var arq;
                    var subTipos;

                    subTipos = tipo.split("/");

                    arq = "XTR_";

                    if(["municipios","mesorregioes","microrregioes"].indexOf(subTipos[1]) >= 0){ //MAPA DE MUNICIPIOS
                        arq += "MUNICIPIOS_"
                        switch(subTipos[2]){
                            case "brasil":
                                arq += "BRASIL";
                                break;
                            case "estados":
                                arq += subTipos[3].toUpperCase();
                                break;
                        }
                    }
                    else if("estados" == subTipos[1]){
                        arq += "ESTADOS_BRASIL";
                    }

                    return arq;
                }
        ////////////////////////
        //METODOS PARA TABELA //
        ////////////////////////
            ////////////////////////////////
            //METODO DE CRIACAO DE TABELA //
            ////////////////////////////////
                function nowYouSeeMeMore(tableId,mesclar){
                    var compositeData;

                    compositeData = dataHandler.search("tabela",0);

                    if(compositeData.rotulos.length > 30){
                        alert("Não é possivel personalizar grafico com dados por Município");
                        return;
                    }

                    document.getElementById(tableId).innerHTML="";

                    addLoading();

                    makeTable(tableId,mesclar);

                    removeLoading();
                }
                function makeTable(tableId,mesclando){
                    var tableMaker;

                    var compositeData;

                    compositeData = dataHandler.search("tabela",0);

                    tableMaker = TableMaker(tableId,compositeData,chunkSize,mesclando);
                    tableMaker.make(true);
                }                   
        </script>
    </body>
    </html>